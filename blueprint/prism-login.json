{"status":{},"contains_secrets":false,"product_version":"3.3.1","spec":{"description":"Custom Prism login page\n**URL:** [https:\/\/@@{nginx.address}@@\/](https:\/\/@@{nginx.address}@@\/)","resources":{"client_attrs":{"2d0ccc9f_deployment":{"y":-589.5,"x":-36.5}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"nginx"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"7700f8a1_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"5f93f105_runbook","main_task_local_reference":{"kind":"app_task","name":"7700f8a1_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"nginx"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"73a7c30e_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"91006c0a_runbook","main_task_local_reference":{"kind":"app_task","name":"73a7c30e_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"nginx"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"fc872b97_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"2d34a30f_runbook","main_task_local_reference":{"kind":"app_task","name":"fc872b97_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"nginx"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"d01ef8c0_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"e0679bde_runbook","main_task_local_reference":{"kind":"app_task","name":"d01ef8c0_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"nginx"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"72258d33_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"8178ba9d_runbook","main_task_local_reference":{"kind":"app_task","name":"72258d33_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"nginx","port_list":[],"tier":"","variable_list":[],"description":""}],"substrate_definition_list":[{"description":"","action_list":[{"description":"","type":"fragment","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHVnginx"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"a81cadcc_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"ee8152e9_runbook","main_task_local_reference":{"kind":"app_task","name":"a81cadcc_dag"},"variable_list":[]},"name":"pre_action_create"},{"description":"","type":"fragment","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHVnginx"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"14228429_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"21c9e037_runbook","main_task_local_reference":{"kind":"app_task","name":"14228429_dag"},"variable_list":[]},"name":"post_action_delete"}],"type":"AHV_VM","name":"AHVnginx","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"CRED"}},"os_type":"Linux","create_spec":{"name":"prism-login-@@{calm_time}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"17ed42c6-b3fd-4862-8cf5-b908fe2ccfae"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":1,"gpu_list":[],"memory_size_mib":4096,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nssh_pwauth: True\nchpasswd:\n  list: |\n     @@{CRED.username}@@:@@{CRED.secret}@@\n  expire: False\nusers:\n  - name: @@{CRED.username}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']\n    shell: \/bin\/bash\n"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"414884f5-4299-4f3b-906f-d3382e201e0e","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"LEGACY","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"ubuntu_20_04_cloud","uuid":"05c09905-7c0a-49db-b407-f9bbed8d8e1c"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]}],"credential_definition_list":[{"username":"ubuntu","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"name":"CRED","cred_class":"static"}],"package_definition_list":[{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"nginx"}],"name":"Package1","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package1"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"01_resize_disk"},{"kind":"app_task","name":"03_update_os"},{"kind":"app_task","name":"04_install_docker"},{"kind":"app_task","name":"06_install_app"},{"kind":"app_task","name":"02_disk_restart"},{"kind":"app_task","name":"05_update_restart"}],"name":"8acc080a_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"03_update_os"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"04_install_docker"}},{"from_task_reference":{"kind":"app_task","name":"01_resize_disk"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"02_disk_restart"}},{"from_task_reference":{"kind":"app_task","name":"02_disk_restart"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"03_update_os"}},{"from_task_reference":{"kind":"app_task","name":"04_install_docker"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"05_update_restart"}},{"from_task_reference":{"kind":"app_task","name":"05_update_restart"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"06_install_app"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"nginx"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"01_resize_disk","attrs":{"script":"import requests\n\n# -------------- Test Environment ------------------\n# import urllib3\n# urllib3.disable_warnings()\n# vm_uuid = 'cc5c5a73-e7e2-410d-96ee-e0bd5b12d1a5'\n# authorization = 'Basic YWRtaW46bngyVGVjaDkxMSE='\n# url = 'https:\/\/10.38.2.9:9440\/api\/nutanix\/v3\/{}'\n# disk_size = 200*1024\n\n\n# -------------- Calm Environment ------------------\nvm_uuid = \"@@{id}@@\"\nauthorization = 'Bearer @@{calm_jwt}@@'\nurl = 'https:\/\/127.0.0.1:9440\/api\/nutanix\/v3\/{}'\ndisk_size = 200*1024\n\n\nkwargs = {\n    'verify': False,\n    'headers': {'Authorization': authorization}\n}\n\n\n######################## GET VM SPEC ########################\n\nresp = requests.get(url.format('vms\/'+vm_uuid), **kwargs)\nif resp.status_code == 200:\n    print('INFO - get VM API was successful')\n    response = resp.json()\nelse:\n    print('ERROR - get vm api call failed, vm uuid: {}, status code: {}'.format(vm_uuid, resp.status_code))\n    print('ERROR - Msg: {}'.format(resp.content))\n    exit(1)\n\n\ndel response['status']\n\n# let's address the space allocation on disk 0\ndel response['spec']['resources']['disk_list'][0]['disk_size_bytes']\nresponse['spec']['resources']['disk_list'][0]['disk_size_mib'] = disk_size\n\nresp = requests.put(url.format('vms\/'+vm_uuid), json=response, **kwargs)\nif resp.status_code == 202:\n    print('INFO - VM updated was successful')\nelse:\n    print('ERROR - VM uuid: {} update operation failed, status code: {}'.format(vm_uuid, resp.status_code))\n    print('ERROR - Msg: {}'.format(resp.content))\n    exit(1)\n","type":"","command_line_args":"","exit_status":[],"script_type":"static"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"nginx"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"03_update_os","attrs":{"script":"\nsudo apt update -y\nsudo apt upgrade -y\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"nginx"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"04_install_docker","attrs":{"script":"# install docker-ce\necho \"---- installing docker\"\nsudo apt -y install apt-transport-https ca-certificates curl software-properties-common\ncurl -fsSL https:\/\/download.docker.com\/linux\/ubuntu\/gpg | sudo apt-key add -\nsudo add-apt-repository \"deb [arch=amd64] https:\/\/download.docker.com\/linux\/ubuntu focal stable\"\nsudo apt -y update\nsudo apt install -y docker-ce docker-ce-cli\nsudo usermod -aG docker ${USER}\n\n# install docker compose\necho \"\\n---- installing docker-compose\"\nsudo apt install -y docker-compose\n\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"nginx"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"06_install_app","attrs":{"script":"git clone https:\/\/github.com\/halsayed\/prism-custom-dashboard.git app\n\nmkdir -p .\/app\/nginx\/ssl\nopenssl req -new -newkey rsa:2048 -days 365 -nodes -x509 \\\n  -subj \"\/C=US\/ST=NewYork\/L=Springfield\/O=Dis\/CN=@@{address}@@\" \\\n  -keyout .\/app\/nginx\/ssl\/nginx.key  -out .\/app\/nginx\/ssl\/nginx.cert\n  \necho 'PRISM_HOST=@@{PRISM_HOST}@@\nPRISM_PORT=@@{PRISM_PORT}@@' | tee .\/app\/.env\ncd app\ndocker-compose up -d\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"nginx"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"02_disk_restart","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__substrate__AHVnginx__action_restart__runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"nginx"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"05_update_restart","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__substrate__AHVnginx__action_restart__runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"c292a462_runbook","main_task_local_reference":{"kind":"app_task","name":"8acc080a_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"e6f4db9b_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"8066fc6f_runbook","main_task_local_reference":{"kind":"app_task","name":"e6f4db9b_dag"},"variable_list":[]}},"variable_list":[]},{"description":"Standard ubuntu 20.04 cloud image","action_list":[],"type":"SUBSTRATE_IMAGE","service_local_reference_list":[],"name":"ubuntu_20_04_cloud","version":"","options":{"type":"","name":"ubuntu_20_04_cloud","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"https:\/\/cloud-images.ubuntu.com\/focal\/current\/focal-server-cloudimg-amd64.img","version":{"product_version":"20.04","type":"","product_name":"ubuntu"},"architecture":"X86_64","type":""},"description":""},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"name":"2d0ccc9f_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"Package1"}],"substrate_local_reference":{"kind":"app_substrate","name":"AHVnginx"},"variable_list":[],"description":""}],"environment_reference_list":[],"patch_list":[],"description":"","action_list":[],"name":"Default","restore_config_list":[],"snapshot_config_list":[],"variable_list":[{"val_type":"STRING","is_mandatory":true,"description":"Default: 9440","data_type":"BASE","type":"LOCAL","name":"PRISM_PORT","value":"9440","label":"Prism Central Port","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":true,"description":"Hostname or IP address of Prism Central","data_type":"BASE","type":"LOCAL","name":"PRISM_HOST","value":"10.38.12.9","label":"Prism Central","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"CRED"},"type":"USER"},"name":"prism-login2"},"api_version":"3.0","metadata":{"last_update_time":"1635161439051434","kind":"blueprint","spec_version":4,"creation_time":"1635153020680371","name":"prism-login2"}}